<template>
  <div class="ui_bar">
    <div
        @click="start"
        class="timer">타이머A
    </div>
    <div class="icon">
      <svg
          @click="participantList"
          xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-people-fill"
          viewBox="0 0 16 16">
        <path
            d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7Zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm-5.784 6A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216ZM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/>
      </svg>
      <svg
          @click="documentBox"
          xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-cloud-plus"
          viewBox="0 0 16 16">
        <path fill-rule="evenodd"
              d="M8 5.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V10a.5.5 0 0 1-1 0V8.5H6a.5.5 0 0 1 0-1h1.5V6a.5.5 0 0 1 .5-.5z"/>
        <path
            d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
      </svg>
      <svg
          v-if="video === true"
          @click="getVideoControl"
          xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-camera-video-fill"
          viewBox="0 0 16 16">
        <path fill-rule="evenodd"
              d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/>
      </svg>
      <svg
          v-if="video === false"
          @click="getVideoControl"
          xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor"
                                                                                                                         class="bi bi-camera-video-off-fill" viewBox="0 0 16 16" style="color: red">
        <path fill-rule="evenodd"
              d="M10.961 12.365a1.99 1.99 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272l6.69 9.365zm-10.114-9A2.001 2.001 0 0 0 0 5v6a2 2 0 0 0 2 2h5.728L.847 3.366zm9.746 11.925-10-14 .814-.58 10 14-.814.58z"/>
      </svg>
      <svg
          v-if="!store.state.debate.micro_phone"
          @click="[start(), getAudioControl()]"
          xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-mic-mute-fill"
          viewBox="0 0 16 16" style="color: red">
        <path d="M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0v1zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4zm3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3z"/>
        <path d="M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607zm-7.84-9.253 12 12 .708-.708-12-12-.708.708z"/>
      </svg>
      <svg
          v-if="store.state.debate.micro_phone"
          @click="[stop(), getAudioControl()]"
          xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-mic-fill"
          viewBox="0 0 16 16">
        <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/>
        <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
      </svg>
      <svg
          @click="chatBox"
          xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-chat-square-text"
          viewBox="0 0 16 16">
        <path
            d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2.5a2 2 0 0 0-1.6.8L8 14.333 6.1 11.8a2 2 0 0 0-1.6-.8H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2.5a1 1 0 0 1 .8.4l1.9 2.533a1 1 0 0 0 1.6 0l1.9-2.533a1 1 0 0 1 .8-.4H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
        <path
            d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
      </svg>
      <a
          href="javascript:;" data-bs-toggle="modal" data-bs-target="#depositMethod">
        <svg
            xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-x-lg"
            viewBox="0 0 16 16" style="color: white">
          <path
              d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
        </svg>
      </a>
      <router-link :to="{ name: 'debatewaiting' }">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="40" fill="currentColor" class="bi bi-airplane"
             viewBox="0 0 16 16">
          <path
              d="M6.428 1.151C6.708.591 7.213 0 8 0s1.292.592 1.572 1.151C9.861 1.73 10 2.431 10 3v3.691l5.17 2.585a1.5 1.5 0 0 1 .83 1.342V12a.5.5 0 0 1-.582.493l-5.507-.918-.375 2.253 1.318 1.318A.5.5 0 0 1 10.5 16h-5a.5.5 0 0 1-.354-.854l1.319-1.318-.376-2.253-5.507.918A.5.5 0 0 1 0 12v-1.382a1.5 1.5 0 0 1 .83-1.342L6 6.691V3c0-.568.14-1.271.428-1.849Zm.894.448C7.111 2.02 7 2.569 7 3v4a.5.5 0 0 1-.276.447l-5.448 2.724a.5.5 0 0 0-.276.447v.792l5.418-.903a.5.5 0 0 1 .575.41l.5 3a.5.5 0 0 1-.14.437L6.708 15h2.586l-.647-.646a.5.5 0 0 1-.14-.436l.5-3a.5.5 0 0 1 .576-.411L15 11.41v-.792a.5.5 0 0 0-.276-.447L9.276 7.447A.5.5 0 0 1 9 7V3c0-.432-.11-.979-.322-1.401C8.458 1.159 8.213 1 8 1c-.213 0-.458.158-.678.599Z"/>
        </svg>
      </router-link>
    </div>
    <div class="timer">타이머B</div>
  </div>

  <blogtempmodal></blogtempmodal>
</template>

<script>``
import {mapActions, useStore} from 'vuex';
import {mapState, mapMutations} from 'vuex';
import debatewaiting from "./debatewaiting.vue";
import {reactive} from "vue";

export default {
  components: {debatewaiting},
  setup() {
    const store = useStore();
    const start = () => {
      let debateId = store.state.debate.participantInfo.debateId
      let time = store.state.debate.participantInfo.time

      console.log('uibar start!!!!!!!');
      sendMessage({
        id: 'startSpeaking',
        debateId: debateId,
        // debateId: store.state["debate/debateId"],
        time: time
      });
    }

    const stop = () => {
      let debateId = store.state.debate.participantInfo.debateId
      console.log('스탑스탑')

      sendMessage({
        id: 'pauseSpeaking',
        debateId: debateId
      });
    }

    const sendMessage = (message) => {
      const ws = reactive(store.getters["debate/getWebRtcSocket"]);
      // const ws = store.state.debate.webRtcSocket;
      console.log(ws)
      console.log('send message', message)
      let jsonMessage = JSON.stringify(message);
      console.log('Sending message: ' + jsonMessage);
      ws.send(jsonMessage);
    }

    return {store, start, stop}
  },
  data() {
    return {
      menubar: false,
    }
  },
  computed: {
    ...mapState('debate', {micro_phone: 'micro_phone'}),
    ...mapState('debate', {video: 'video'}),
  },
  methods: {
    ...mapMutations('debate', {participantList: 'participantList'}),
    ...mapMutations('debate', {microPhone: 'microPhone'}),
    ...mapMutations('debate', {chatBox: 'chatBox'}),
    ...mapMutations('debate', {documentBox: 'documentBox'}),
    ...mapActions('debate', {getAudioControl: 'getAudioControl'}),
    ...mapActions('debate', {getVideoControl: 'getVideoControl'}),
  },
}
</script>

<style scoped>
.ui_bar {
  background: black;
  width: 100%;
  height: 8vh;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  margin: 0 0 0 0;
}

.icon {
  color: white;
}

.icon > svg:active {
  color: lightgrey;
}

.timer {
  color: lightpink;
  margin-left: 20px;
  margin-right: 20px;

}

.menubar {
  background-color: #00d285;
  border: 5px solid red;
}

</style>